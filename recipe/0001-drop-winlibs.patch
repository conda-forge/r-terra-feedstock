From 2d3ee4352ad6f2de4637fdca623006365b0c6048 Mon Sep 17 00:00:00 2001
From: Mervin Fansler <mmfansler@gmail.com>
Date: Fri, 10 Feb 2023 11:19:47 -0500
Subject: [PATCH] drop winlibs

---
 src/Makevars.win | 23 +++++++----------------
 tools/winlibs.R  | 15 ---------------
 2 files changed, 7 insertions(+), 31 deletions(-)
 delete mode 100644 tools/winlibs.R

diff --git a/src/Makevars.win b/src/Makevars.win
index f2edbe3..e28e14c 100644
--- a/src/Makevars.win
+++ b/src/Makevars.win
@@ -1,14 +1,11 @@
-VERSION = 3.4.1
-RWINLIB = ../windows/gdal3-$(VERSION)
-TARGET = lib$(subst gcc,,$(COMPILED_BY))$(R_ARCH)
-
-PKG_CPPFLAGS =\
-	-I$(RWINLIB)/include \
+PKG_CPPFLAGS = \
+	-Iwin64 \
+	-I$(LIBRARY_PREFIX_CYG)/include \
 	-DHAVE_PROJ_H
 
 PKG_LIBS = \
-	-L$(RWINLIB)/$(TARGET) \
-	-L$(RWINLIB)/lib$(R_ARCH) \
+	-Lwin64 \
+	-L$(LIBRARY_PREFIX_CYG)/lib \
 	-lgdal -lsqlite3 -lspatialite -lproj -lgeos_c -lgeos  \
 	-ljson-c -lnetcdf -lmariadbclient -lpq -lpgport -lpgcommon \
 	-lwebp -lcurl -lssh2 -lssl \
@@ -20,15 +17,9 @@ PKG_LIBS = \
 
 CXX_STD = CXX11
 
-all: clean winlibs
-
-winlibs:
-	mkdir -p ../inst
-	"${R_HOME}/bin${R_ARCH_BIN}/Rscript.exe" --vanilla "../tools/winlibs.R" $(VERSION)
-	cp -r "$(RWINLIB)/share/gdal" ../inst/
-	cp -r "$(RWINLIB)/share/proj" ../inst/
+all: clean
 
 clean:
 	rm -f $(SHLIB) $(OBJECTS)
 
-.PHONY: all winlibs clean
+.PHONY: all clean
diff --git a/tools/winlibs.R b/tools/winlibs.R
deleted file mode 100644
index 2a6f805..0000000
--- a/tools/winlibs.R
+++ /dev/null
@@ -1,15 +0,0 @@
-
-if(getRversion() < "3.3.0") {
-	stop("Your version of R is too old. This package requires R-3.3.0 or newer on Windows.")
-}
-
-# Download gdal-3.* from rwinlib
-VERSION <- commandArgs(TRUE)
-testfile <- sprintf("../windows/gdal3-%s/include/gdal-%s/gdal.h", VERSION, VERSION)
-if(!file.exists(testfile)){
-	download.file(sprintf("https://github.com/rwinlib/gdal3/archive/v%s.zip", VERSION), "lib.zip", quiet = TRUE)
-	dir.create("../windows", showWarnings = FALSE)
-	unzip("lib.zip", exdir = "../windows")
-	unlink("lib.zip")
-}
-
-- 
2.39.0

