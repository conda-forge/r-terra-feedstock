From 3821bddd05a9853c8158e2c6bc05dfd96fc97074 Mon Sep 17 00:00:00 2001
From: Mervin Fansler <mmfansler@gmail.com>
Date: Fri, 10 Feb 2023 13:54:36 -0500
Subject: [PATCH] drop winlibs

---
 src/Makevars.win | 32 ++++++++------------------------
 tools/winlibs.R  | 15 ---------------
 2 files changed, 8 insertions(+), 39 deletions(-)
 delete mode 100644 tools/winlibs.R

diff --git a/src/Makevars.win b/src/Makevars.win
index f2edbe3..c2c0740 100644
--- a/src/Makevars.win
+++ b/src/Makevars.win
@@ -1,34 +1,18 @@
-VERSION = 3.4.1
-RWINLIB = ../windows/gdal3-$(VERSION)
-TARGET = lib$(subst gcc,,$(COMPILED_BY))$(R_ARCH)
-
-PKG_CPPFLAGS =\
-	-I$(RWINLIB)/include \
+PKG_CPPFLAGS = \
+	-Iwin64 \
+	-I$(LIBRARY_PREFIX_CYG)/include \
 	-DHAVE_PROJ_H
 
 PKG_LIBS = \
-	-L$(RWINLIB)/$(TARGET) \
-	-L$(RWINLIB)/lib$(R_ARCH) \
-	-lgdal -lsqlite3 -lspatialite -lproj -lgeos_c -lgeos  \
-	-ljson-c -lnetcdf -lmariadbclient -lpq -lpgport -lpgcommon \
-	-lwebp -lcurl -lssh2 -lssl \
-	-lhdf5_hl -lhdf5 -lexpat -lfreexl -lcfitsio \
-	-lmfhdf -lhdf -lxdr -lpcre \
-	-lopenjp2 -ljasper -lpng -ljpeg -ltiff -lgeotiff -lgif -lxml2 -llzma -lz -lzstd \
-	-lodbc32 -lodbccp32 -liconv -lpsapi -lwldap32 -lsecur32 -lgdi32 -lnormaliz \
-	-lcrypto -lcrypt32 -lws2_32 -lshlwapi -lbcrypt
+	-Lwin64 \
+	-L$(LIBRARY_PREFIX_CYG)/lib \
+	-lgdal -lsqlite3 -lspatialite -lproj -lgeos_c -lgeos
 
 CXX_STD = CXX11
 
-all: clean winlibs
-
-winlibs:
-	mkdir -p ../inst
-	"${R_HOME}/bin${R_ARCH_BIN}/Rscript.exe" --vanilla "../tools/winlibs.R" $(VERSION)
-	cp -r "$(RWINLIB)/share/gdal" ../inst/
-	cp -r "$(RWINLIB)/share/proj" ../inst/
+all: clean
 
 clean:
 	rm -f $(SHLIB) $(OBJECTS)
 
-.PHONY: all winlibs clean
+.PHONY: all clean
diff --git a/tools/winlibs.R b/tools/winlibs.R
deleted file mode 100644
index 2a6f805..0000000
--- a/tools/winlibs.R
+++ /dev/null
@@ -1,15 +0,0 @@
-
-if(getRversion() < "3.3.0") {
-	stop("Your version of R is too old. This package requires R-3.3.0 or newer on Windows.")
-}
-
-# Download gdal-3.* from rwinlib
-VERSION <- commandArgs(TRUE)
-testfile <- sprintf("../windows/gdal3-%s/include/gdal-%s/gdal.h", VERSION, VERSION)
-if(!file.exists(testfile)){
-	download.file(sprintf("https://github.com/rwinlib/gdal3/archive/v%s.zip", VERSION), "lib.zip", quiet = TRUE)
-	dir.create("../windows", showWarnings = FALSE)
-	unzip("lib.zip", exdir = "../windows")
-	unlink("lib.zip")
-}
-
-- 
2.39.0

